# レスポンシブ対応方針

> **Task ID**: P1-DE-001
> **Designer**: 玉田（第1中隊デザイン担当）
> **対象**: アリサ（FE実装担当）
> **作成日**: 2026-01-30

---

## 1. 設計原則

- **モバイルファースト**: PWA対応予定のため、モバイルを基準に設計
- **Tailwind CSS v4** のブレイクポイントを使用
- タッチデバイスとマウスデバイスの両方を考慮

---

## 2. ブレイクポイント定義

| 名称 | Tailwind prefix | 幅 | 主な対象 |
|------|----------------|-----|---------|
| Mobile (default) | なし | `< 640px` | スマートフォン |
| Tablet | `sm:` | `640px - 1023px` | タブレット |
| Desktop | `lg:` | `1024px - 1279px` | ノートPC |
| Large | `xl:` | `>= 1280px` | デスクトップモニタ |

---

## 3. 作品選択モード（/discover）のレスポンシブ対応

### 3.1 カードサイズ

| ブレイクポイント | カード幅 | カード高さ | レイアウト |
|----------------|---------|-----------|----------|
| Mobile | `calc(100vw - 32px)` | `calc(100vh - 184px)` | フルスクリーンカード |
| Tablet | `420px` | `600px` | 中央配置カード |
| Desktop | `440px` | `640px` | 中央配置 + サイドパネル |
| Large | `480px` | `680px` | 中央配置 + サイドパネル |

### 3.2 デスクトップ（lg以上）レイアウト

デスクトップではカードの横に作品詳細パネルを表示。

```
┌────────────────────────────────────────────────┐
│  ヘッダー                                       │
├──────────────────┬─────────────────────────────┤
│                  │                              │
│   ┌──────────┐   │  作品詳細パネル               │
│   │          │   │                              │
│   │  カード   │   │  タイトル（H1）              │
│   │          │   │  著者名                      │
│   │          │   │  ジャンルタグ                 │
│   │          │   │                              │
│   │          │   │  あらすじ（全文表示）          │
│   │          │   │                              │
│   └──────────┘   │  [読み始める]  [お気に入り]    │
│                  │                              │
│   ← ✕  ● ● ○  ♡→│  関連作品                    │
│                  │  [作品A] [作品B] [作品C]       │
├──────────────────┴─────────────────────────────┤
│  ボトムナビ → サイドナビに変更                     │
└────────────────────────────────────────────────┘
```

**デスクトップ固有:**
- カードスワイプは維持（マウスドラッグ対応）
- キーボードショートカット: `←` スキップ / `→` お気に入り / `Enter` 読書開始
- サイドパネル幅: `400px` (lg), `480px` (xl)

### 3.3 ナビゲーション変更

| ブレイクポイント | ナビタイプ | 位置 |
|----------------|----------|------|
| Mobile / Tablet | ボトムナビ (64px) | 画面下部 |
| Desktop / Large | サイドナビ (240px) | 画面左側 |

---

## 4. 読書モード（/read）のレスポンシブ対応

### 4.1 テキストエリア

| ブレイクポイント | padding | max-width | font-size (default) |
|----------------|---------|-----------|---------------------|
| Mobile | `24px 20px` | 100% | `18px` |
| Tablet | `40px 60px` | 100% | `18px` |
| Desktop | `40px auto` | `720px` | `18px` |
| Large | `48px auto` | `800px` | `18px` |

### 4.2 タップゾーン → クリックゾーン

デスクトップではマウスクリックに置き換え：

| Mobile (タップ) | Desktop (クリック) | 追加操作 |
|----------------|-------------------|---------|
| 左タップ | 左クリック (左1/4) | `←` キー |
| 右タップ | 右クリック (右1/4) | `→` キー |
| 中央タップ | 中央クリック | `Escape` キー |
| ダブルタップ | ダブルクリック | `B` キー |
| ピンチ | なし | `Ctrl+` / `Ctrl-` |
| 横スワイプ | なし | `Shift+←` / `Shift+→` |

### 4.3 UIオーバーレイ（デスクトップ）

デスクトップでは常時表示のサイドコントロールに変更可能:

```
┌────────────────────────────────────────────────┐
│  [←] 第一章「猫の始まり」              [⋮]     │
├──────┬─────────────────────────────┬───────────┤
│      │                            │           │
│ 目次 │      本文テキスト            │  設定     │
│      │                            │           │
│ 1章  │      テキストが表示される     │  書体     │
│ 2章◀ │      エリア                 │  サイズ   │
│ 3章  │                            │  テーマ   │
│ ...  │                            │  明るさ   │
│      │                            │           │
│      │                            │  しおり   │
│      │                            │  一覧     │
├──────┴─────────────────────────────┴───────────┤
│  ◀ 前の話     ████████░░ 32%      次の話 ▶     │
└────────────────────────────────────────────────┘
```

- 目次パネル: `width: 200px`, `lg:` で表示
- 設定パネル: `width: 200px`, `xl:` で表示
- パネルは折りたたみ可能（トグルボタン付き）

---

## 5. タッチ vs マウス検出

```typescript
// デバイス判定フック
function useInputMode(): 'touch' | 'mouse' {
  // 'ontouchstart' in window → touch対応デバイス
  // pointer: coarse → タッチ操作がメイン
  // pointer: fine → マウス操作がメイン
  // 両方対応の場合はタッチ優先
}
```

**Tailwind v4 での使い分け:**

```html
<!-- タッチデバイスのみスワイプヒント表示 -->
<div class="block @pointer-coarse:block @pointer-fine:hidden">
  スワイプしてね
</div>

<!-- マウスデバイスのみホバー効果 -->
<div class="lg:hover:shadow-xl lg:hover:scale-[1.02] transition">
```

---

## 6. Safe Area 対応（PWA/ノッチ）

```css
/* ヘッダー */
padding-top: env(safe-area-inset-top);

/* ボトムナビ */
padding-bottom: env(safe-area-inset-bottom);
height: calc(64px + env(safe-area-inset-bottom));

/* 読書モード左右マージン */
padding-left: max(20px, env(safe-area-inset-left));
padding-right: max(20px, env(safe-area-inset-right));
```

---

## 7. パフォーマンス考慮

### 7.1 画像最適化

| ブレイクポイント | カバー画像サイズ | 形式 |
|----------------|----------------|------|
| Mobile | 390w | WebP / AVIF |
| Tablet | 640w | WebP / AVIF |
| Desktop | 480w (カードは小さくなる) | WebP / AVIF |

```html
<Image
  src={coverUrl}
  sizes="(max-width: 640px) 100vw, (max-width: 1024px) 640px, 480px"
  priority={isTopCard}
/>
```

### 7.2 フォント読み込み

```typescript
// Next.js のフォント最適化
import { Noto_Serif_JP, Noto_Sans_JP } from 'next/font/google';

const notoSerifJP = Noto_Serif_JP({
  subsets: ['latin'],
  weight: ['400', '700'],
  display: 'swap',
  preload: true,
});
```

- `Noto Serif JP` (読書用): 400, 700 のみ
- `Noto Sans JP` (UI用): 400, 500, 600, 700
- `display: 'swap'` で FOUT 許容（FOITより UX が良い）

### 7.3 スワイプパフォーマンス

- カードドラッグ中は `will-change: transform` を付与
- GPU アクセラレーション: `transform: translateZ(0)`
- 背面カードは `pointer-events: none` で入力無効化
- カード画像には `loading="eager"` (上位3枚) / `loading="lazy"` (それ以降)

---

## 8. ブレイクポイント別 チェックリスト

### Mobile (< 640px)
- [ ] カードがフルスクリーン表示される
- [ ] スワイプジェスチャーが正常動作する
- [ ] ボトムナビが safe-area 対応している
- [ ] 読書モードで没入感が確保されている
- [ ] ピンチで文字サイズが変更できる
- [ ] 横書き/縦書きが切り替わる

### Tablet (640px - 1023px)
- [ ] カードが中央配置で420px幅
- [ ] ボトムナビが維持される
- [ ] 読書モードの padding が広がる
- [ ] タップゾーンが適切に機能する

### Desktop (1024px+)
- [ ] カード横にサイドパネルが表示される
- [ ] ナビがサイドナビに切り替わる
- [ ] キーボードショートカットが使える
- [ ] マウスドラッグでカードスワイプできる
- [ ] ホバーエフェクトが適用される
- [ ] 読書モードで目次/設定パネルが表示可能
